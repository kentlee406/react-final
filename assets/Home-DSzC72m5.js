import{r,k as s,S as A,A as R,m as E}from"./vendor-DCgf3J4u.js";import{a as d}from"./vendor-axios-B9ygI19o.js";import{a as I,u as L}from"./index-DAGqcCRM.js";import{g as B}from"./authToken-DvrakIaH.js";import{L as m}from"./vendor-router-BS-I_zzl.js";import"./vendor-redux-B-LDsaQv.js";import"./vendor-bootstrap-DsuGXcVh.js";const p="https://ec-course-api.hexschool.io/v2",u="kentlee406";function z(){const[i,y]=r.useState([]),[n,h]=r.useState([]),[c,x]=r.useState(""),[w,v]=r.useState("全部"),{showLoading:S,hideLoading:_}=r.useContext(I),{showNotification:l}=L(),g={height:"240px",objectFit:"cover"},P=e=>{const t=Number(e.origin_price||0),a=Number(e.price||0);return!t||t<=a?0:(t-a)/t*100},$=r.useMemo(()=>["全部",...new Set(i.map(e=>e.category).filter(Boolean))],[i]),b=r.useMemo(()=>{if(!n.length)return[];const e=new Map;return n.forEach(t=>{Object.values(t.products||{}).forEach(a=>{const o=a.product_id||a.product?.id;if(!o)return;const k=Number(a.final_total||0)||Number(a.total||0)||Number(a.qty||0)*Number(a.product?.price||0),f=e.get(o)||{product:a.product,amount:0};e.set(o,{product:a.product||f.product,amount:f.amount+k})})}),[...e.values()].filter(t=>t.product).sort((t,a)=>a.amount-t.amount).slice(0,3).map(t=>t.product)},[n]),N=r.useMemo(()=>[...i].filter(e=>Number(e.origin_price)>0&&Number(e.origin_price)>Number(e.price)).sort((e,t)=>{const a=(Number(e.origin_price)-Number(e.price))/Number(e.origin_price);return(Number(t.origin_price)-Number(t.price))/Number(t.origin_price)-a}).slice(0,3),[i]),C=async()=>{try{S();const e=await d.get(`${p}/api/${u}/products/all`);y(e.data.products||[]);const t=B();if(t){const a=await d.get(`${p}/api/${u}/admin/orders`,{headers:{Authorization:t}});h(a.data.orders||[])}else h([])}catch{l("首頁資料載入失敗，請稍後再試","error",8e3)}finally{_()}},j=async e=>{try{x(e);const t={data:{product_id:e,qty:1}};await d.post(`${p}/api/${u}/cart`,t),l("產品已新增至購物車","success",6e3)}catch{l("新增購物車失敗，請稍後再試","error",8e3)}finally{x("")}};return r.useEffect(()=>{C()},[]),s.jsxs("main",{children:[s.jsx("section",{className:"mb-5",children:s.jsx(A,{modules:[R],spaceBetween:16,slidesPerView:1,loop:i.length>1,style:{width:"100%",maxWidth:"100%"},children:i.map(e=>s.jsx(E,{children:s.jsx("img",{src:e.imageUrl,alt:e.title,className:"home-swiper-image",style:{display:"block",margin:"0 auto",border:"2px solid var(--bs-success)"}})},e.id))})}),s.jsx("section",{className:"mb-5",children:s.jsx("div",{className:"d-flex flex-wrap gap-2",children:$.map(e=>{const t=e==="全部"?"/products":`/products?category=${encodeURIComponent(e)}`;return s.jsx(m,{to:t,className:`btn ${w===e?"btn-success":"btn-outline-success"}`,style:{fontSize:"1.25em"},onClick:()=>v(e),children:e},e)})})}),b.length>=3&&s.jsxs("section",{className:"mb-5",children:[s.jsx("h2",{className:"fw-bold",children:"熱銷產品"}),s.jsx("div",{className:"row g-4",children:b.map(e=>s.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:s.jsxs("div",{className:"card",children:[s.jsx("img",{src:e.imageUrl,className:"card-img-top",alt:e.title,style:g}),s.jsxs("div",{className:"card-body",children:[s.jsxs("h5",{className:"card-title",children:[s.jsx(m,{to:`/product/${e.id}`,children:e.title}),s.jsx("span",{className:"badge bg-primary ms-2",children:e.category})]}),s.jsxs("div",{className:"d-flex",children:[s.jsx("p",{className:"card-text text-secondary",children:s.jsx("del",{children:e.origin_price})})," 元 / ",e.price," 元"]}),s.jsx("button",{type:"button",className:"btn btn-primary w-100",disabled:c===e.id,onClick:()=>j(e.id),children:c===e.id?"加入中...":"加入購物車"})]})]})},e.id))})]}),N.length>=3&&s.jsxs("section",{className:"mb-5",children:[s.jsx("h2",{className:"fw-bold",children:"促銷產品"}),s.jsx("div",{className:"row g-4",children:N.map(e=>s.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:s.jsxs("div",{className:"card position-relative",children:[s.jsx("span",{className:"badge rounded-pill bg-danger position-absolute top-0 end-0 m-2",children:`${P(e).toFixed(1)}% OFF`}),s.jsx("img",{src:e.imageUrl,className:"card-img-top",alt:e.title,style:g}),s.jsxs("div",{className:"card-body",children:[s.jsxs("h5",{className:"card-title",children:[s.jsx(m,{to:`/product/${e.id}`,children:e.title}),s.jsx("span",{className:"badge bg-primary ms-2",children:e.category})]}),s.jsxs("div",{className:"d-flex",children:[s.jsx("p",{className:"card-text text-secondary",children:s.jsx("del",{children:e.origin_price})})," 元 / ",e.price," 元"]}),s.jsx("button",{type:"button",className:"btn btn-primary w-100",disabled:c===e.id,onClick:()=>j(e.id),children:c===e.id?"加入中...":"加入購物車"})]})]})},e.id))})]})]})}export{z as default};
