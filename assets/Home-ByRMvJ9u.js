import{r,k as s,S as k,A,m as E}from"./vendor-DCgf3J4u.js";import{a as m}from"./vendor-axios-B9ygI19o.js";import{a as I,u as z}from"./index-DDEivxHH.js";import{L as l}from"./vendor-router-BS-I_zzl.js";import"./vendor-redux-B-LDsaQv.js";import"./vendor-bootstrap-DsuGXcVh.js";const p="https://ec-course-api.hexschool.io/v2",u="kentlee406";function U(){const[i,f]=r.useState([]),[o,y]=r.useState([]),[c,x]=r.useState(""),[w,S]=r.useState("全部"),{showLoading:v,hideLoading:$}=r.useContext(I),{showNotification:d}=z(),h={height:"240px",objectFit:"cover"},_=e=>{const t=Number(e.origin_price||0),a=Number(e.price||0);return!t||t<=a?0:(t-a)/t*100},P=r.useMemo(()=>["全部",...new Set(i.map(e=>e.category).filter(Boolean))],[i]),b=r.useMemo(()=>{if(!o.length)return[];const e=new Map;return o.forEach(t=>{Object.values(t.products||{}).forEach(a=>{const n=a.product_id||a.product?.id;if(!n)return;const R=Number(a.final_total||0)||Number(a.total||0)||Number(a.qty||0)*Number(a.product?.price||0),j=e.get(n)||{product:a.product,amount:0};e.set(n,{product:a.product||j.product,amount:j.amount+R})})}),[...e.values()].filter(t=>t.product).sort((t,a)=>a.amount-t.amount).slice(0,3).map(t=>t.product)},[o]),g=r.useMemo(()=>[...i].filter(e=>Number(e.origin_price)>0&&Number(e.origin_price)>Number(e.price)).sort((e,t)=>{const a=(Number(e.origin_price)-Number(e.price))/Number(e.origin_price);return(Number(t.origin_price)-Number(t.price))/Number(t.origin_price)-a}).slice(0,3),[i]),C=async()=>{try{v();const e=await m.get(`${p}/api/${u}/products/all`);f(e.data.products||[]);const t=await m.get(`${p}/api/${u}/orders`);y(t.data.orders||[])}catch{d("首頁資料載入失敗，請稍後再試","error",8e3)}finally{$()}},N=async e=>{try{x(e);const t={data:{product_id:e,qty:1}};await m.post(`${p}/api/${u}/cart`,t),d("產品已新增至購物車","success",6e3)}catch{d("新增購物車失敗，請稍後再試","error",8e3)}finally{x("")}};return r.useEffect(()=>{C()},[]),s.jsxs("main",{children:[s.jsx("section",{className:"mb-5",children:s.jsx(k,{modules:[A],autoplay:{delay:3e3,disableOnInteraction:!1,pauseOnMouseEnter:!0},speed:800,spaceBetween:16,slidesPerView:1,loop:i.length>1,style:{width:"100%",maxWidth:"100%"},children:i.map(e=>s.jsx(E,{children:s.jsx(l,{to:`/product/${e.id}`,children:s.jsx("img",{src:e.imageUrl,alt:e.title,className:"home-swiper-image",style:{display:"block",margin:"0 auto",border:"2px solid var(--bs-success)"}})})},e.id))})}),s.jsx("section",{className:"mb-5",children:s.jsx("div",{className:"d-flex flex-wrap gap-2",children:P.map(e=>{const t=e==="全部"?"/products":`/products?category=${encodeURIComponent(e)}`;return s.jsx(l,{to:t,className:`btn ${w===e?"btn-success":"btn-outline-success"}`,style:{fontSize:"1.25em"},onClick:()=>S(e),children:e},e)})})}),b.length>=3&&s.jsxs("section",{className:"mb-5",children:[s.jsx("h2",{className:"fw-bold",children:"熱銷產品"}),s.jsx("div",{className:"row g-4",children:b.map(e=>s.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:s.jsxs("div",{className:"card",children:[s.jsx("img",{src:e.imageUrl,className:"card-img-top",alt:e.title,style:h}),s.jsxs("div",{className:"card-body",children:[s.jsxs("h5",{className:"card-title fw-bold",style:{fontSize:"1.5em"},children:[s.jsx(l,{to:`/product/${e.id}`,children:e.title}),s.jsx("span",{className:"badge bg-primary ms-2",children:e.category})]}),s.jsxs("p",{className:"card-text text-secondary small mb-2",children:["規格：",e.unit]}),s.jsxs("div",{className:"d-flex",children:[s.jsx("p",{className:"card-text text-secondary",children:s.jsxs("del",{children:["$",e.origin_price]})}),"/",s.jsxs("span",{className:"text-danger fw-bold ms-1",style:{fontSize:"1.5em"},children:["$",e.price]})]}),s.jsx("button",{type:"button",className:"btn btn-primary w-100",disabled:c===e.id,onClick:()=>N(e.id),children:c===e.id?"加入中...":"加入購物車"})]})]})},e.id))})]}),g.length>=3&&s.jsxs("section",{className:"mb-5",children:[s.jsx("h2",{className:"fw-bold",children:"促銷產品"}),s.jsx("div",{className:"row g-4",children:g.map(e=>s.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:s.jsxs("div",{className:"card position-relative",children:[s.jsx("span",{className:"badge rounded-pill bg-danger position-absolute top-0 end-0 m-2",children:`${_(e).toFixed(1)}% OFF`}),s.jsx("img",{src:e.imageUrl,className:"card-img-top",alt:e.title,style:h}),s.jsxs("div",{className:"card-body",children:[s.jsxs("h5",{className:"card-title fw-bold",style:{fontSize:"1.5em"},children:[s.jsx(l,{to:`/product/${e.id}`,children:e.title}),s.jsx("span",{className:"badge bg-primary ms-2",children:e.category})]}),s.jsxs("p",{className:"card-text text-secondary small mb-2",children:["規格：",e.unit]}),s.jsxs("div",{className:"d-flex",children:[s.jsx("p",{className:"card-text text-secondary",children:s.jsxs("del",{children:["$",e.origin_price]})}),"/",s.jsxs("span",{className:"text-danger fw-bold ms-1",style:{fontSize:"1.5em"},children:["$",e.price]})]}),s.jsx("button",{type:"button",className:"btn btn-primary w-100",disabled:c===e.id,onClick:()=>N(e.id),children:c===e.id?"加入中...":"加入購物車"})]})]})},e.id))})]})]})}export{U as default};
