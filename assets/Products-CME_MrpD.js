import{r as t,k as s}from"./vendor-DCgf3J4u.js";import{a as j}from"./vendor-axios-B9ygI19o.js";import"./vendor-bootstrap-DsuGXcVh.js";import{a as E,u as F}from"./index-BWS5zvhs.js";import{P as L}from"./Pagination-D75gfH_0.js";import{a as _,L as I}from"./vendor-router-BS-I_zzl.js";import"./vendor-redux-B-LDsaQv.js";const N="https://ec-course-api.hexschool.io/v2",y="kentlee406";function Q(){const[o,P]=t.useState([]),[d,i]=t.useState(1),[m,x]=t.useState(""),[c,u]=t.useState("全部"),[S,h]=_(),n=6,{showLoading:w,hideLoading:v}=t.useContext(E),{showNotification:l}=F(),$=async()=>{try{w();const e=await j.get(`${N}/api/${y}/products/all`);P(e.data.products),i(1)}catch{l("取得產品列表失敗，請稍後再試","error",8e3)}finally{v()}},C=async e=>{try{x(e);const a={data:{product_id:e,qty:1}};await j.post(`${N}/api/${y}/cart`,a),l("產品已新增至購物車","success",6e3)}catch{l("新增購物車失敗，請稍後再試","error",8e3)}finally{x("")}},g=e=>{const a=Number(e.origin_price||0),b=Number(e.price||0);return!a||a<=b?0:(a-b)/a*100},k=["全部",...new Set(o.map(e=>e.category).filter(Boolean))],p=S.get("category")||"全部",r=c==="全部"?o:o.filter(e=>e.category===c),f=(d-1)*n,A=r.slice(f,f+n);return t.useEffect(()=>{$()},[]),t.useEffect(()=>{u(p),i(1)},[p]),s.jsxs(s.Fragment,{children:[s.jsx("h2",{children:"產品列表"}),s.jsx("div",{className:"d-flex flex-wrap gap-2 mb-4",children:k.map(e=>s.jsx("button",{type:"button",className:`btn ${c===e?"btn-success":"btn-outline-success"}`,"aria-pressed":c===e,onClick:()=>{if(u(e),i(1),e==="全部"){h({});return}h({category:e})},children:e},e))}),s.jsx("div",{className:"cards",children:s.jsx("div",{className:"row g-4",children:r&&r.length>0?A.map(e=>s.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:s.jsxs("div",{className:"card position-relative",children:[g(e)>0&&s.jsx("span",{className:"badge rounded-pill bg-danger position-absolute top-0 end-0 m-2",children:`${g(e).toFixed(1)}% OFF`}),s.jsx("img",{src:e.imageUrl,className:"card-img-top",alt:e.title}),s.jsxs("div",{className:"card-body",children:[s.jsxs("h5",{className:"card-title fw-bold",style:{fontSize:"1.5em"},children:[s.jsx(I,{to:`/product/${e.id}`,children:e.title}),s.jsx("span",{className:"badge bg-primary ms-2",children:e.category})]}),s.jsxs("p",{className:"card-text text-secondary small mb-2",children:["規格：",e.unit]}),s.jsxs("div",{className:"d-flex",children:[s.jsx("p",{className:"card-text text-secondary",children:s.jsxs("del",{children:["$",e.origin_price]})}),"/",s.jsxs("span",{className:"text-danger fw-bold ms-1",style:{fontSize:"1.5em"},children:["$",e.price]})]}),s.jsx("button",{type:"button",className:"btn btn-primary w-100",disabled:m===e.id,onClick:()=>C(e.id),children:m===e.id?"加入中...":"加入購物車"})]})]})},e.id)):"目前尚無產品資料"})}),r.length>n&&s.jsx(L,{products:r,pageSize:n,currentPage:d,setCurrentPage:i})]})}export{Q as default};
